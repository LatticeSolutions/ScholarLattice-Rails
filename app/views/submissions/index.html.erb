<% content_for :title, "Submissions | #{@collection.title}" %>

<section class="mx-auto md:w-3/4 w-full">
    <%= render partial: "breadcrumb", locals: { collection: @collection } %>
    
    <h1 class="text-2xl font-bold text-gray-900 md:text-3xl py-5">
        Submissions for
        <%= link_to @collection.title, @collection, class: "hover:underline text-blue-700" %>
        (<%= @submissions.count %>)
    </h1>

    <% if can? :manage, @collection %>
    <div class="py-2">
        <%= link_to "New Submission", new_collection_submission_path(@collection), class: "bg-blue-500 hover:bg-blue-700 text-white py-2 px-4 rounded" %>
        <%= link_to "Download CSV", collection_submissions_path(@collection, format: :csv), class: "bg-green-500 hover:bg-green-700 text-white py-2 px-4 rounded" %>
        <%= link_to "Upload Submissions", collection_submissions_upload_path(@collection), class: "bg-yellow-500 hover:bg-yellow-700 text-white py-2 px-4 rounded" %>
    </div>

    <h2 class="text-xl font-medium text-gray-800 md:text-2xl py-3">
        <span class="size-4 inline-block">
            <%= render IconComponent.new(:key) %>
        </span>
        Unreviewed, no invite (<%= @submissions.where(status: :submitted).reject(&:invited?).length %>):
    </h2>
    <div class="grid grid-cols-1 gap-4 lg:grid-cols-3 lg:gap-8">
        <% @submissions.where(status: :submitted).reject(&:invited?).each do |submission| %>
            <%= render partial: "submissions/card", locals: { submission: submission, collection: @collection } %>
        <% end %>
    </div>
    <div class="text-gray-700 py-3">
        Emails:
        <textarea class="w-full h-12 bg-gray-100 p-2" readonly><%= 
            @submissions.where(status: :submitted).reject(&:invited?).map{|s| s.user.email }.join("; ")
        %></textarea>
    </div>
    <h2 class="text-xl font-medium text-gray-800 md:text-2xl py-3">
        <span class="size-4 inline-block">
            <%= render IconComponent.new(:key) %>
        </span>
        Unreviewed, invited (<%= @submissions.where(status: :submitted).filter(&:invited?).length %>):
    </h2>
    <div class="grid grid-cols-1 gap-4 lg:grid-cols-3 lg:gap-8">
        <% @submissions.where(status: :submitted).filter(&:invited?).each do |submission| %>
            <%= render partial: "submissions/card", locals: { submission: submission, collection: @collection } %>
        <% end %>
    </div>
    <div class="text-gray-700 py-3">
        Emails:
        <textarea class="w-full h-12 bg-gray-100 p-2" readonly><%= 
            @submissions.where(status: :submitted).filter(&:invited?).map{|s| s.user.email }.join("; ")
        %></textarea>
    </div>
    <% end %>

    <h2 class="text-xl font-medium text-gray-800 md:text-2xl py-3">
        <span class="size-4 inline-block">
            <%= render IconComponent.new(:key) %>
        </span>
        Accepted (<%= @submissions.where(status: :accepted).count %>):
    </h2>
    <div class="grid grid-cols-1 gap-4 lg:grid-cols-3 lg:gap-8">
        <% @submissions.where(status: :accepted).each do |submission| %>
            <%= render partial: "submissions/card", locals: { submission: submission, collection: @collection } %>
        <% end %>
    </div>

    <% if can? :manage, @collection %>
    <div class="text-gray-700 py-3">
        Emails:
        <textarea class="w-full h-12 bg-gray-100 p-2" readonly><%= 
            @submissions.where(status: :accepted).map{|s| s.user.email }.join("; ")
        %></textarea>
    </div>
    <h2 class="text-xl font-medium text-gray-800 md:text-2xl py-3">
        <span class="size-4 inline-block">
            <%= render IconComponent.new(:key) %>
        </span>
        Declined  (<%= @submissions.where(status: :declined).count %>):
    </h2>
    <div class="grid grid-cols-1 gap-4 lg:grid-cols-3 lg:gap-8">
        <% @submissions.where(status: :declined).each do |submission| %>
            <%= render partial: "submissions/card", locals: { submission: submission, collection: @collection } %>
        <% end %>
    </div>
    <div class="text-gray-700 py-3">
        Emails:
        <textarea class="w-full h-12 bg-gray-100 p-2" readonly><%= 
            @submissions.where(status: :declined).map{|s| s.user.email }.join("; ")
        %></textarea>
    </div>
    <% end %>
</section>
